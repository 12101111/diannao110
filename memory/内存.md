# 内存

随机存取存储器（英语：Random Access Memory，RAM），是与CPU直接交换数据的内部存储器，也叫内存。它可以随时读写（刷新时除外，见下文），而且速度很快，通常作为操作系统或其他正在运行中的程序的临时数据存储媒介。所有可执行程序必须都入到内存中才能被CPU执行，但断电时内存的数据会清空。

## 分类

RAM 存储器可以进一步分为静态随机存取内存（SRAM）和动态随机存取内存（DRAM）两大类。SRAM具有快速访问的优点，不需要刷新，但生产成本较为昂贵，一个典型的应用是CPU缓存。而DRAM需要刷新，速度相对较慢，由于具有较低的单位容量价格，所以被大量的采用作为系统的内存。

### SRAM

静态随机存取存储器（Static Random-Access Memory，SRAM）是随机存取存储器的一种。所谓的“静态”，是指这种存储器只要保持通电，里面储存的数据就可以一直保持。相对之下，动态随机存取存储器（DRAM）里面所储存的数据就需要周期性地更新。然而，当电力供应停止时，SRAM储存的数据还是会消失（被称为volatile memory），这与在断电后还能储存资料的ROM或闪存是不同的。

#### SRAM特点

SRAM是比DRAM更为昂贵，但更为快速、非常低功耗（特别是在空闲状态）。因此SRAM首选用于带宽要求高，或者功耗要求低，或者二者兼而有之。SRAM比起DRAM更为容易控制，也更是随机访问。由于复杂的内部结构，SRAM比DRAM的占用面积更大，因而不适合用于更高储存密度低成本的应用，如PC内存。

SRAM功耗取决于它的访问频率。如果用高频率访问SRAM，其功耗比得上DRAM。有的SRAM在全带宽时功耗达到几个瓦特量级。另一方面，SRAM如果用于温和的时钟频率的微处理器，其功耗将非常小，在空闲状态时功耗可以忽略不计—几个微瓦特级别。

#### SRAM用途

    作为微控制器的RAM或者cache（通常从32 bytes到128 KB）如硬盘、光驱、路由器、显示器、打印机、汽车电子电路。
    作为强大的微处理器的主caches，如x86系列与许多其它CPU（从8 KB到几MB的量级）
    作为寄存器（参见寄存器堆）
    用于特定的ICs或ASIC（通常在几KB量级）
    用于FPGA与CPLD

### DRAM

动态随机存取存储器（Dynamic Random Access Memory，DRAM）是一种半导体内存，主要的作用原理是利用电容内存储电荷的多寡来代表一个二进制比特（bit）是1还是0。由于在现实中电容会有漏电的现象，导致电位差不足而使记忆消失，因此除非电容经常周期性地充电，否则无法确保记忆长存。由于这种需要定时刷新的特性，因此被称为“动态”内存。相对来说，静态内存（SRAM）只要存入数据后，纵使不刷新也不会丢失记忆。

与SRAM相比，DRAM的优势在于结构简单——每一个比特的数据都只需一个电容跟一个晶体管来处理，相比之下在SRAM上一个比特通常需要六个晶体管。正因这缘故，DRAM拥有非常高的密度，单位体积的容量较高因此成本较低。但相反的，DRAM也有访问速度较慢，耗电量较大的缺点。

与大部分的随机存取内存（RAM）一样，由于存在DRAM中的数据会在电力切断以后很快消失，因此它属于一种易失性内存（volatile memory）设备。

如今世界有三强SDRAM颗粒制造商：韩国的三星电子(Samsung Electronics)和海力士(Hynix)，及美国的美光科技(Micron Technology)。三者垄断超过90%的全球市场，包括PC RAM、手机RAM和服务器RAM。

#### DRAM特点

##### 随机存取

所谓“随机存取”，指的是当存储器中的消息被读取或写入时，所需要的时间与这段信息所在的位置无关。相对地，有串行访问存储器包括顺序访问存储器（如：磁带）和直接访问存储器（如：磁盘）。

##### 易失性

当电源关闭时RAM不能保留数据。如果需要保存数据，就必须把它们写入一个长期的存储设备中（例如硬盘）。RAM和ROM相比，两者的最大区别是RAM在断电以后保存在上面的数据会自动消失，而ROM则不会。

##### 较高的访问速度

现代的随机存取存储器几乎是所有访问设备中写入和读取速度最快的，访问延迟也和其他涉及机械运作的存储设备（如硬盘、光驱）相比，也显得微不足道。但速度仍然不如作为CPU缓存用的SRAM。目前的DRAM快于NAND，然而有一些实验中的技术可以使闪存的速度快于内存。

##### 需要刷新

现代的随机存取存储器依赖电容器存储数据。电容器充满电后代表1（二进制），未充电的代表0。由于电容器或多或少有漏电的情形，若不作特别处理，电荷会渐渐随时间流失而使数据发生错误。刷新是指重新为电容器充电，弥补流失了的电荷。DRAM的读取即有刷新的功效，但一般的定时刷新并不需要作完整的读取，只需作该芯片的一个列（Row）选择，整列的数据即可获得刷新，而同一时间内，所有相关记忆芯片均可同时作同一列选择，因此，在一段期间内逐一做完所有列的刷新，即可完成所有存储器的刷新。需要刷新正好解释了随机存取存储器的易失性。

##### 对静电敏感

正如其他精细的集成电路，随机存取存储器对环境的静电荷非常敏感。静电会干扰存储器内电容器的电荷，引致数据流失，甚至烧坏电路。故此触碰随机存取存储器前，应先用手触摸金属接地。

##### 极长的寿命

除了制造出来即损坏的DRAM，正常使用中（排除安装内存失败，超频等情况）内存能工作数十年之久，理论上读写寿命极长。但DRAM也会损坏，例如挖矿数月的矿卡，经常由于散热条件差，24小时不间断超频工作而导致显存损坏。

##### 价格不断下降

现在鬼才信这条。在2016年后失效，详见内存价格曲线。摩尔定律于2016年一并失效（详见2017年北京NVIDIA GTC大会，NVIDIA CEO黄仁勋）。

## DRAM在PC上的应用

DRAM的规范由JEDEC固态技术协会制定，JEDEC是固态及半导体工业界的一个标准化组织，在20世纪初曾经是联合电子管工程委员会（Joint Electron Tube Engineering Council）。JEDEC早期的工作是制定半导体器件编码，保证厂商之间产品的互换性。很多二极管和三极管至今仍在使用JEDEC的编号。1999年秋，JEDEC成为独立行业协会，抛弃原先的全称。静电敏感警告标记由JEDEC发布，并得到了广泛使用。

### SDRAM

同步动态随机存取內存（synchronous dynamic random-access memory，简称SDRAM）是有一个同步接口的动态随机存取內存（DRAM）。通常DRAM是有一个异步接口的，这样它可以随时响应控制输入的变化。而SDRAM有一个同步接口，在响应控制输入前会等待一个时钟信号，这样就能和计算机的系统总线同步。时钟被用来驱动一个有限状态机，对进入的指令进行管线(Pipeline)操作。这使得SDRAM与没有同步接口的异步DRAM(asynchronous DRAM)相比，可以有一个更复杂的操作模式。管线意味着芯片可以在处理完之前的指令前，接受一个新的指令。在一个写入的管线中，写入命令在另一个指令执行完之后可以立刻执行，而不需要等待数据写入存储队列的时间。在奔腾PRO时代，PCI总线的频率为33mHz,当时对应的SDRAM的频率也为33mHz，即PC-33内存。而奔腾II时代，Intel改进了前端总线，使其频率达到100mHz，对应的内存频率为100mHz（PC-100）。奔腾III则改为了133mHz（PC-133)。

### DDR SDRAM

双倍数据率同步动态随机存取内存（英语：Double Data Rate Synchronous Dynamic Random Access Memory，简称DDR SDRAM）为具有双倍数据传输率的SDRAM，其数据传输速度为系统时钟频率的两倍，由于速度增加，其传输性能优于传统的SDRAM。SDRAM在一个时钟周期内只传输一次数据，它是在时钟上升期进行数据传输；DDR SDRAM 在系统时钟的上升沿和下降沿都可以进行数据传输。前文提到，SDRAM有管线设计，指令可用暂存到预取缓冲器（prefetch buffer）中。SDRAM的预取缓冲器深度为1，而DDR　SDRAM一个周期可用读取2倍的数据，因此预取缓冲器深度设计为2。由于数据量的翻倍，DDR SDRAM的等效数据频率为核心频率和IO时钟频率的两倍。在DDR内存年代，内存的时钟频率仍然需要和总线频率同步。

#### DDR2 SDRAM

DDR2，四倍数据率同步动态随机存取内存，其预取缓冲器深度设计为4bit，等效数据频率：IO时钟频率：核心频率=4：2：1。

DDR2的等效频率由于电气接口的改进（包括on-die termination, prefetch buffers 和 off-chip drivers）而大增。然而，CAS等待时间却增长了。DDR2预读取是4位，而DDR预读取是2位，DDR3预读取是8位。DDR SDRAM一般是2到3个总线周期的读取等待时间，而DDR2一般是4到6个总线周期的读取等待时间。

DDR2更加节能，其工作电压从DDR的2.5V到1.8V。

#### DDR3 SDRAM

DDR3，八倍数据率同步动态随机存取内存，其预取缓冲器深度设计为8bit，等效数据频率：IO时钟频率：核心频率=8：4：1。

DDR3 SDRAM为了更省电、传输效率更快，使用SSTL 15的I/O接口，运作I/O电压是1.5V，采用CSP、FBGA封装方式包装，除了延续DDR2 SDRAM的ODT、OCD、Posted CAS、AL控制方式外，另外新增更为精进的CWD、Reset、ZQ、SRT、PASR功能。

CWD是作为写入延迟之用，Reset提供超省电功能的命令，可以让DDR3 SDRAM内存颗粒电路停止运作、进入超省电待命模式，ZQ则是一个新增的终端电阻校准功能，新增这个线路脚位提供了ODCE（On Die Calibration Engine）用来校准ODT（On Die Termination）内部终端电阻，新增SRT（Self-Reflash Temperature）可编程化温度控制内存时钟频率功能，SRT的加入让内存颗粒在温度、时钟频率和电源管理上进行优化，可以说在内存内，就做了电源管理的功能，同时让内存颗粒的稳定度也大为提升，确保内存颗粒不致于工作时钟频率过高导致烧毁的状况，同时DDR3 SDRAM还加入PASR（Partial Array Self-Refresh）局部Bank刷新的功能，可以说针对整个内存Bank做更有效的数据读写以达到省电功效。

2010年7月26日，JEDEC发布DDR3L标准。DDR3的电压为1.5V，而DDR3L的电压为1.35V，DDR3L内存的SPD芯片里包含支持电压的数据，可根据主板内存插槽的支持自适应1.5V或者1.35V的工作电压。

#### DDR4 SDRAM

DDR4相比DDR3，直接将频率翻倍，预取缓冲器深度设计仍为8bit。

#### 各代DDR标准内存频率表

<table>
<tbody><tr>
<td style="background:#ffdead; font-weight:bold;">标准名称</td>
<td style="background:#ffdead; font-weight:bold;">I/O 总线时钟频率<br>
<small>(MHz)</small></td>
<td style="background:#ffdead; font-weight:bold;">周期<br>
<small>(ns)</small></td>
<td style="background:#ffdead; font-weight:bold;">内存时钟频率<br>
<small>(MHz)</small></td>
<td style="background:#ffdead; font-weight:bold;">数据速率<br>
<small>(MT/s)</small></td>
<td style="background:#99ff99; font-weight:bold;">模块名称</td>
<td style="background:#99ff99; font-weight:bold;">极限传输率<br>
<small>(GB/s)</small></td>
<td style="background:#99ff99; font-weight:bold;">比特宽<br>
<small>(比特)</small></td>
</tr>
<tr>
<td>DDR-200</td>
<td>100</td>
<td>10</td>
<td>100</td>
<td>200</td>

<td>PC-1600</td>
<td>1.6</td>
<td>64</td>
</tr>
<tr>
<td>DDR-266</td>
<td>133</td>
<td>7.5</td>
<td>133</td>
<td>266</td>

<td>PC-2100</td>
<td>2.1</td>
<td>64</td>
</tr>
<tr>
<td>DDR-333</td>
<td>166</td>
<td>6</td>
<td>166</td>
<td>333</td>

<td>PC-2700</td>
<td>2.7</td>
<td>64</td>
</tr>
<tr>
<td>DDR-400</td>
<td>200</td>
<td>5</td>
<td>200</td>
<td>400</td>

<td>PC-3200</td>
<td>3.2</td>
<td>64</td>
</tr><tr>
<td>DDR2-400</td>
<td>200</td>
<td>10</td>
<td>100</td>
<td>400</td>

<td>PC2-3200</td>
<td>3.2</td>
<td>64</td>
</tr>
<tr>
<td>DDR2-533</td>
<td>266</td>
<td>7.5</td>
<td>133</td>
<td>533</td>

<td>PC2-4200<br>
PC2-4300</td>
<td>4.3</td>
<td>64</td>
</tr>
<tr>
<td>DDR2-667</td>
<td>333</td>
<td>6</td>
<td>166</td>
<td>667</td>

<td>PC2-5300<br>
PC2-5400</td>
<td>5.3</td>
<td>64</td>
</tr>
<tr>
<td>DDR2-800</td>
<td>400</td>
<td>5</td>
<td>200</td>
<td>800</td>

<td>PC2-6400</td>
<td>6.4</td>
<td>64</td>
</tr>
<tr>
<td>DDR2-1066</td>
<td>533</td>
<td>3.75</td>
<td>266</td>
<td>1066</td>

<td>PC2-8500<br>
PC2-8600</td>
<td>8.5</td>
<td>64</td>
</tr>
<tr>
<td>DDR3-800</td>
<td>400</td>
<td>10</td>
<td>100</td>
<td>800</td>

<td>PC3-6400</td>
<td>6.4</td>
<td>64</td>
</tr>
<tr>
<td>DDR3-1066</td>
<td>533</td>
<td>7<sup>1</sup>/<sub>2</sub></td>
<td>133</td>
<td>1066</td>

<td>PC3-8500</td>
<td>8.5</td>
<td>64</td>
</tr>
<tr>
<td>DDR3-1333</td>
<td>667</td>
<td>6</td>
<td>166</td>
<td>1333</td>

<td>PC3-10600</td>
<td>10.6</td>
<td>64</td>
</tr>
<tr>
<td>DDR3-1600</td>
<td>800</td>
<td>5</td>
<td>200</td>
<td>1600</td>

<td>PC3-12800</td>
<td>12.8</td>
<td>64</td>
</tr>
<tr>
<td>DDR3-1866</td>
<td>933</td>
<td>4<sup>2</sup>/<sub>7</sub></td>
<td>233</td>
<td>1866</td>

<td>PC3-14900</td>
<td>14.9</td>
<td>64</td>
</tr>
<tr>
<td>DDR3-2133</td>
<td>1066</td>
<td>3<sup>3</sup>/<sub>4</sub></td>
<td>266</td>
<td>2133</td>

<td>PC3-17000</td>
<td>17.0</td>
<td>64</td>
</tr>
<tr>
<td>DDR4-1600</td>
<td>800</td>
<td>5</td>
<td>200</td>
<td>1600</td>

<td>PC4-12800</td>
<td>12.8</td>
<td>64</td>
</tr>
<tr>
<td>DDR4-1866</td>
<td>933.33</td>
<td>4<sup>2</sup>/<sub>7</sub></td>
<td>233.33</td>
<td>1866.67</td>

<td>PC4-14900</td>
<td>14.9</td>
<td>64</td>
</tr>
<tr>
<td>DDR4-2133</td>
<td>1066.67</td>
<td>3<sup>3</sup>/<sub>4</sub></td>
<td>266.67</td>
<td>2133.33</td>

<td>PC4-17000</td>
<td>17.0</td>
<td>64</td>
</tr>
<tr>
<td>DDR4-2400</td>
<td>1200</td>
<td>3<sup>1</sup>/<sub>3</sub></td>
<td>300</td>
<td>2400</td>

<td>PC4-19200</td>
<td>19.2</td>
<td>64</td>
</tr>
<tr>
<td>DDR4-2666</td>
<td>1333</td>
<td>不</td>
<td>算</td>
<td>2666</td>

<td>PC4-21300</td>
<td>21.3</td>
<td>64</td>
</tr>
<tr>
<td>DDR4-3000</td>
<td>1500</td>
<td>了</td>
<td>自</td>
<td>3000</td>

<td>PC4-24000</td>
<td>24.0</td>
<td>64</td>
</tr>
<tr>
<td>DDR4-3200</td>
<td>1600</td>
<td>己</td>
<td>算</td>
<td>3200</td>

<td>PC4-25600</td>
<td>25.6</td>
<td>64</td>
</tr>
</tbody></table>

注意，每次换代时，数据速率虽然会翻倍，但延迟也会翻倍，这导致实际速率不可能直接翻倍，甚至会换代但实际性能不涨。

### DIMM

双列直插式内存模块或双线内存模块（Dual In-line Memory Module，简称DIMM）是指一系列由动态随机存取内存（DRAM）组成的模块。DIMM通常是数颗至数十颗DRAM芯片焊接安装于一块已制作好电路的印刷电路板的形式，用于个人电脑、工作站、服务器。相比SIMM两边针脚相连在一起，DIMM两边针脚是独立的。SIMM的数据总线为32-bit宽度，DIMM则是64-bit宽度。

### SO-DIMM

小外形双列直插式内存模块（英语：small outline dual in-line memory module），通常简称为SO-DIMM或SODIMM，它是一种采用集成电路的电脑内存。SO-DIMM类似DIMM，但它的体积更小，大约是常规DIMM的一半。SO-DIMM经常用于空间有限的系统，例如笔记本电脑、基于Mini-ITX主板的小体积个人电脑，高端可升级办公打印机，以及诸如路由器、NAS设备等网络硬件。

### 双通道内存技术

双通道（英语：Dual-channel）是一种能够让电脑性能增加的技术，此种技术将多个内存由串联方式改良为并联方式，以得到更大的带宽。

使用单通道技术时，主板上多条内存是以串联方式运作，也就是仅是当作一条内存运作，只是容量会相加。内存总线宽度为64-bit，无论安装几条内存，带宽都固定为64-bit。

双通道便是利用并联方式运作，当连接两条内存时，总线宽度将会达到128-bit，而套上内存宽度计算便会知道相差甚远。也就是开双通道后，带宽可以增至两倍，性能也会增加。理论上，双通道能提升内存两倍的性能；对系统整体性能来说，打开双通道带来的性能提升约为2至3%，最好的情况是提升约5%。一直到现在，双通道对整个系统的影响最高只有多5%的性能而已。在实际使用上，若非长时间的极大数据运算或通过软件测试获取测试数据，对于用户的操作上并没有太大的差异。

如果是纯粹的CPU运算，使用双通道近乎没有性能增长。但对于高级游戏玩家或是绘图需求较大的用户而言，双通道技术不吝为一大帮助，因为GPU要经常访问纹理贴图数据，需要很大的内存带宽。所以在使用双通道时，双倍的带宽可使内置绘图核心(核心显卡)的性能增长近一倍，

打开双通道模式最好使用两条规格（容量、时钟频率、延迟、颗粒、品牌、周期）相同的内存。

### 时序

一般数字“A-B-C-D”分别对应的参数是“CL-tRCD-tRP-tRAS”，它们的含义依次为：（单位为ns）

    CAS Latency（CL），内存读写操作前，列地址控制器的延迟时间;
    RAS－to－CAS Delay（tRCD），内存行地址传输到列地址的延迟时间;
    RAS Precharge Delay（tRP），内存行地址选通脉冲预充电时间;
    Row Active Delay（tRAS），内存行地址选通延迟。

时序各值越小越好，但减小时序并不能带来质的改变（改变幅度在10%以内），反而可能使系统不稳定。Cl对性能的影响最大。

## 内存的使用

操作系统运行时，电脑的内存按照被使用情况可分类为：

    可利用（Available）物理内存：可立即分配给程序使用的内存。包括：
        空闲（Free）物理内存：完全未被使用，内容为全0
        缓存（Cached）物理内存
            备用（standby）物理内存：操作系统预先把可能要用到的硬盘数据加载所占用的内存，还没被用户进程所使用，因此可随时丢弃从新初始化为0.
            已修改（modified）物理内存：已被修改过的caching用途的内存，可在任意时刻写回硬盘文件（不是分页文件）然后被重用。由于硬盘I/O，已修改（modified）物理内存不能计入空闲（Free）物理内存
    被使用（used）物理内存：已经被进程使用的内存
        用户进程使用的物理内存，即工作集(Working set)。Working Set包含了可能被其他程序共享的内存, 例如DLL。所以所有进程的Working Set加起来有可能大于实际的被使用（used）的物理内存。
        核心进程使用的物理内存
            分页的核心进程使用的物理内存：可以交换到分页文件中，从而可被回收的物理内存
            未分页（Non paged）的核心进程使用的物理内存：不能交换到分页文件的内存，总是要保留在物理内存中
    硬件保留（hardware reserved）的物理内存：被CPU中的GPU核心或者其他外设硬件占用的，不由操作系统使用的内存。

缓存内存可以加快程序的启动。使用清理内存等工具并没有必要，除非计算机内存严重不足或需要长时间运行一个高负载程序，但遇到此状况操作系统会自动清理缓存并将后台程序写入虚拟内存（分页文件）

## 内存访问的限制

32位的CPU只能访问４GB的内存，但由于Windows的限制，32位的Windows最多访问3.15GB内存，且单个程序最多使用2GB内存。由于服务器版本的Windows可以通过PAE使用最大128GB的内存并将其分配给每个应用程序最大４GB的虚拟内存空间，因此用过编辑产品策略或破解内核可以在普通版Windows XP，Windows 7中启用PAE。不建议进行此操作，因为64位的Windows显然是更好的选择。

PAE，物理地址扩展，是基于x86 的服务器的一种功能，它使运行 Windows Server 2003, Enterprise Edition 和 Windows Server 2003，Datacenter Edition 的计算机可以支持4GB 以上物理内存。物理地址扩展 (PAE) 允许将最多64GB 的物理内存用作常规的4 KB 页面，并扩展内核能使用的位数以将物理内存地址从32扩展到36。